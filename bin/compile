#!/bin/bash

BUILD_DIR=${1:-}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}
BP_DIR=$(cd $(dirname ${0:-}); cd ..; pwd)

# install dependencies

echo "-----> installing dependencies"

curl https://sh.rustup.rs -sSf | sh -s -- -y
export PATH="$HOME/.cargo/bin:$PATH"

echo "installing npm"
curl -qL https://npmjs.org/install.sh | sh

rustup default stable


echo "-----> frontend found"

# Build frontend
cd ./frontend
npm install
npm run build
cd ..

echo "       done"
echo "-----> rust server found"

# Build backend
cargo build -p actix-to-do-server --release
cp ./target/release/actix-to-do-server $BUILD_DIR

echo "       done"